/* =========================================================
   App Theme + Layout (CLEANED)
   - Floating left/right docks
   - Fixed bottom timeline panel
   - Centered stage that reserves dock space (no overlap)
   ========================================================= */


@font-face{
  font-family:"Cascadia";
  src:
    local("Cascadia Code"),
    local("Cascadia Mono"),
    local("Cascadia"),
    url("fonts/Cascadia.ttf") format("truetype");
  font-display: swap;
}


/* -----------------------------
   Theme tokens
----------------------------- */
:root{

  --font: "Cascadia","Cascadia Code","Cascadia Mono",ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;


  /* sizing */
  --header-h: 48px;
  --timeline-h: 190px;

  --sidebar-w: 300px;
  --rightbar-w: 340px;

  --dock-gap: 14px;          /* distance from viewport edge */
  --dock-gap-bottom: 8px;    /* breathing room above timeline */

  --frame-w: 24px;

  /* colors */


  
  --border: #1e2430;
  --ink: #e9eef3;
  --muted: #9aa7b7;
  --accent: #e53935;

  --bg: #0b0e12;
  --panel: #131821;
  --panel2:#0f1319;
  --sticky: #10151d;

  --btn-bg: #1a212c;
  --btn-bd: #2a3240;
  --btn-bg-h: #233044;
  --btn-bd-h: #3b4a61;

  --shadowDock: 0 12px 32px rgba(0,0,0,.45);
  --shadowTop: 0 6px 18px rgba(0,0,0,.35);
}
/* HARD HIDE for the hidden attribute (prevents overlays covering UI) */
[hidden]{
  display:none !important;
}
/* -----------------------------
   Base / reset
----------------------------- */
*{ box-sizing:border-box; }
html,body{ 
  
  height:100%; margin:0; 
  font-family: var(--font);
}
html{ overflow-y: scroll; }

body{
  background:var(--bg);
  color:var(--ink);

  font-size: var(--ui-font);
  line-height: 1.35;
  font-family: var(--font);

  overflow:hidden;               /* prevent page scroll */
  overscroll-behavior:none;
}

/* disable touch panning on canvas */
#stage, #drawCanvas, #fxCanvas, #boundsCanvas{
  touch-action:none;
  -ms-touch-action:none;
}

/* mobile: make island header reliably draggable */
#floatingIslandHeader{ touch-action: none; }


/* -----------------------------
   Top header
----------------------------- */
header.top{
  height: var(--header-h);
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;

  padding: 10px 14px;
  border-bottom: 1px solid var(--border);
  background: #0f141b;
}

/* keep left/right slots aligned without affecting center */
header.top .topSlot{
  min-width: 0;
  display: flex;
  align-items: center;
}

header.top .topSlot.left{
  justify-content: flex-start;
}

header.top .topSlot.right{
  justify-content: flex-end;
}
/* icon from /icons folder */
.brandIcon{
  width: 22px;
  height: 22px;
  border-radius: 6px;
  background: url("./icons/ginyospace.ico") center / contain no-repeat;
  box-shadow: 0 0 0 2px #000 inset;
}

.brandIconR{
  background-image: url("./icons/favicon.ico");
}


.brand{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:800;
  letter-spacing:.5px;
}
.brand .logo{
  width:22px;
  height:22px;
  border-radius:6px;
  background:linear-gradient(135deg,#e53935,#ffcc00 60%,#00e5ff);
  box-shadow:0 0 0 2px #000 inset;
}


/* Swatch drag -> layer row drop target */
[data-layer-row].swatchLayerDropTarget{
  outline: 2px solid rgba(120,200,255,0.65);
  outline-offset: 2px;
  border-radius: 10px;
}



/* INFO_PANEL (unique anchor) */
.topBtn{
  padding: 8px 10px;
  border-radius: 0px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.35);
  color: #fff;
  font: inherit;
  cursor: pointer;
}
.topBtn:hover{ background: rgba(255,255,255,.08); }


/* keep header above everything */
header.top{
  position: relative;
  z-index: 9200;
}

.infoBackdrop{
  position: fixed;
  inset: 0;
  z-index: 9100;

  /* ✅ no blackout */
  background: transparent;

  /* still lets you click outside to close */
  pointer-events: none;

  /* second transition: subtle fade-in "presence" (optional) */
  opacity: 0;
  transition: opacity 180ms ease;
}

.infoBackdrop.isOpen{
  pointer-events: auto;
  opacity: 1; /* still invisible, but "active" */
}

.infoPanel{
  position: fixed;

  pointer-events: none;

  /* ✅ smaller height panel */
  top: calc(var(--header-h) + 10px);
  right: 10px;
  height: min(620px, calc(100dvh - var(--header-h) - 20px));
  width: min(360px, 92vw);


  font-size: 12px;
  line-height: 1.25;


  border-radius: 0px; /* optional nicer */
  overflow: hidden;    /* keeps rounded corners clean */

  /* keep your existing background/border/shadow/z-index */
  background: rgba(18, 20, 24, 0.92);
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: -18px 0 50px rgba(0,0,0,.55);
  z-index: 9150;

  display: flex;
  flex-direction: column;
  outline: none;

  transform: translateX(102%);
  transition: transform 220ms cubic-bezier(.22,.61,.36,1);
  opacity: 0;
  filter: blur(4px);
}

.infoPanel.isOpen{
  transform: translateX(0);
  opacity: 1;
  filter: blur(0);
  pointer-events: auto;
}

.infoHeader{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 12px 12px;
  border-bottom: 1px solid rgba(255,255,255,.12);
}

.infoTitle{
  font-weight: 700;
  letter-spacing: .06em;
  font-size: 12px;
}

.infoText{ font-size: 15px; }
.infoList{ 
  
  
  font-size: 12px; 
  padding-left: 18px;  /* keeps bullets nicely indented */
  margin: 10px 0;

}
.infoLinkBtn{ font-size: 12px; padding: 8px 10px; }

.infoList li{
  margin: 8px 0;       /* spacing between items */
}


.infoBody{
  padding: 12px 12px 16px;
  overflow: auto;
}

.infoText{
  margin: 0 0 12px;
  opacity: .92;
  line-height: 1.35;
}

.infoBtns{
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
  margin-bottom: 12px;
}

.infoLinkBtn{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
  padding: 10px 12px;
  border-radius: 0px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.06);
  color: #fff;
}
.infoLinkBtn:hover{ background: rgba(255,255,255,.10); }

.infoHr{
  border: none;
  border-top: 1px solid rgba(255,255,255,.12);
  margin: 10px 0 12px;
}

.infoH3{
  margin: 0 0 8px;
  font-size: 14px;
  opacity: .95;
}

.infoList{
  margin: 0;
  padding-left: 18px;
  opacity: .9;
  line-height: 1.35;
}

/* ───────── Layer visibility (eye button) ───────── */
#layerSeg label{
  display:flex;
  align-items:center;
  gap:10px;
}

#layerSeg .visBtn{
  width:26px;
  height:26px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.06);
  color:#fff;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  flex:0 0 auto;
  font-size:16px;
  line-height:1;
  padding:0;
}
#layerSeg .visBtn:hover{ background: rgba(255,255,255,0.08); }
#layerSeg .visBtn.is-hidden{ opacity:0.45; filter: grayscale(1); }

#layerSeg .layerSwatches{
  margin-left:auto;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:6px;
  flex-wrap:wrap;
}



#layerSeg label{
  display:flex;
  align-items:center;
  gap:8px;
}

#layerSeg .visBtn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:28px;
  height:28px;
  border:0;
  border-radius:8px;
  background:transparent;
  cursor:pointer;
  font-size:16px;
  line-height:1;
}

#layerSeg .visBtn.is-hidden{
  opacity:.55;
}


#layerSeg .visBtn:hover{
  background: rgba(255,255,255,0.08);
}

#layerSeg .visBtn.is-hidden{
  opacity: 0.45;
  filter: grayscale(1);
}


/* Layer segment: put swatches at right side of each label */
#layerSeg label{
  display:flex;
  align-items:center;
  gap:10px;
}

#layerSeg .layerName{
  display:inline-flex;
  align-items:center;
}

#layerSeg .layerSwatches{
  margin-left:auto;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:6px;
  flex-wrap:wrap;
}

#layerSeg .layerSwatchBtn{
  width:16px;
  height:16px;
  border-radius:0px;
  border:1px solid var(--btn-bd);
  padding:0;
  cursor:pointer;
  background:#000;
}

.layerSwatchBtn.swatchDragging{
  transform: scale(1.06);
  outline: 2px solid rgba(255,255,255,0.35);
}

body.swatch-reordering{
  cursor: grabbing;
}



/* ACTIVE_LAYER_SWATCH_GREEN (unique anchor) */
.layerSwatchBtn.activeOnActiveLayer{
  box-shadow:
    0 0 0 2px #00e676,
    0 0 0 1px rgba(0,0,0,.55) inset;
}

/* folder caret + nesting */
.layerSwatchBtn{
  position: relative;
  margin-left: calc(var(--swatchDepth, 0) * 12px);
}

/* hide children when ancestor collapsed */
.layerSwatchBtn[data-hidden-by-folder="1"]{
  display: none;
}

/* caret indicator */
.layerSwatchBtn .swatchCaret{
  position: absolute;
  left: 6px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 12px;
  line-height: 1;
  color: #fff;
  text-shadow: 0 1px 2px rgba(0,0,0,.7);
  pointer-events: auto;
  user-select: none;
}

.layerSwatchBtn{ position:relative; }

#swatchCtxMenu{
  min-width: 170px;
  padding: 6px;
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 10px;
  background: rgba(18,18,18,.95);
  backdrop-filter: blur(10px);
  box-shadow: 0 12px 40px rgba(0,0,0,.55);
}

#swatchCtxMenu button{
  width: 100%;
  display: block;
  border: 0;
  background: transparent;
  color: #fff;
  text-align: left;
  padding: 10px 10px;
  border-radius: 8px;
  cursor: pointer;
  font: 600 13px/1.1 system-ui, sans-serif;
}

#swatchCtxMenu button:hover{
  background: rgba(255,255,255,.08);
}

#swatchCtxMenu button.danger{
  color: #ff6b6b;
}

#swatchCtxMenu{
  position: fixed;
  z-index: 99999;
  min-width: 160px;
  background: #111;
  border: 1px solid #333;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0,0,0,.45);
  padding: 6px;
}

#swatchCtxMenu button{
  width: 100%;
  text-align: left;
  background: transparent;
  border: 0;
  color: #eee;
  padding: 10px 10px;
  border-radius: 8px;
  cursor: pointer;
  font: inherit;
}

#swatchCtxMenu button:hover{
  background: rgba(255,255,255,.08);
}

/* Layer opacity popup */
#layerOpacityMenu{
  position: fixed;
  z-index: 2147483600;
  min-width: 220px;
  padding: 10px 10px 9px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(18,20,26,0.98);
  box-shadow: 0 14px 40px rgba(0,0,0,0.55);
  color: #fff;
}

#layerOpacityMenu .lom-title{
  font-size: 12px;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  opacity: 0.85;
  margin-bottom: 8px;
}

#layerOpacityMenu #lomRange{
  width: 100%;
}

#layerOpacityMenu .lom-row{
  margin-top: 8px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

#layerOpacityMenu .lom-val{
  font-size: 12px;
  opacity: 0.9;
  font-variant-numeric: tabular-nums;
}

#layerOpacityMenu .lom-reset{
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.08);
  color: inherit;
  cursor: pointer;
}

#layerOpacityMenu .lom-reset:hover{
  background: rgba(255,255,255,0.14);
}

/* Layer row menu (right-click a layer row) */
#layerRowMenu{
  position: fixed;
  z-index: 99999;
  background: #161a20;
  border: 1px solid #2a3340;
  border-radius: 10px;
  padding: 6px;
  min-width: 180px;
  box-shadow: 0 18px 48px rgba(0,0,0,0.55);
}

#layerRowMenu .lrm-btn{
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  padding: 8px 10px;
  border: 0;
  border-radius: 8px;
  background: transparent;
  color: #e7edf6;
  cursor: pointer;
  text-align: left;
}

#layerRowMenu .lrm-btn:hover{
  background: rgba(255,255,255,0.06);
}

#layerRowMenu .lrm-btn:disabled{
  opacity: 0.45;
  cursor: default;
}

#layerRowMenu .lrm-chk{
  width: 1.3em;
  display: inline-block;
  text-align: center;
  opacity: 0.9;
}

/* Optional: small badge on the layer row when clip is enabled */
.clipBadge{
  margin-left: 6px;
  margin-right: 6px;
  font-size: 12px;
  opacity: 0.8;
}

label.isClippedToBelow .clipBadge{
  opacity: 1;
}

/* -----------------------------
   Controls styling
----------------------------- */
:where(button, .seg input + label, .dock-btn, .edge-btn){
  background:var(--btn-bg);
  color:#dfe7f1;
  border:1px solid var(--btn-bd);
  border-radius:10px;
  padding:8px 10px;
  cursor:pointer;
}
:where(button, .seg input + label, .dock-btn, .edge-btn):hover{
  background:var(--btn-bg-h);
  border-color:var(--btn-bd-h);
}

.row{
  display:flex;
  align-items:center;
  gap:8px;
  margin:6px 0;
  flex-wrap:wrap;
}
.row label{
  color:#c7d0db;
  min-width:108px;
}

.btns{ display:flex; flex-wrap:wrap; gap:8px; }

.seg{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}
.seg input{ display:none; }
.seg label{
  user-select:none;
  padding:6px 12px;
  height:28px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:220px;
}
.seg input:checked + label{
  background:var(--btn-bg-h);
  border-color:var(--btn-bd-h);
}

/* SELECTED_LAYER_GREEN_OUTLINE (unique anchor) */
#layerSeg > input:checked + label{
  border-color: #00e676 !important;
  box-shadow: 0 0 0 2px #00e676 inset;
}

.chip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:4px 8px;
  border:1px solid var(--btn-bd);
  border-radius:8px;
  background:#151c26;
  font-size:12px;
  color:#c7d0db;
}
.swatch{
  width:16px;
  height:16px;
  border-radius:4px;
  border:1px solid var(--btn-bd);
}

.badge{
  font-size:12px;
  color:#c7d0db;
  background:#1a2230;
  border:1px solid var(--btn-bd);
  border-radius:999px;
  padding:3px 10px;
}

/* -----------------------------
   App container
   (single canvas area; panels float)
----------------------------- */
.app{
  position:relative;
  width:100%;
  height: calc(100vh - var(--header-h));   /* fallback */
  height: calc(100dvh - var(--header-h));  /* modern */
  min-height:0;
}


/* Reserve dock widths (no overlap) */
.app{
  --pad-left: 0px;
  --pad-right: 0px;
}
 /* 
.app:not(.sidebar-collapsed){
  --pad-left: calc(var(--sidebar-w) + var(--dock-gap) + 2px);
}
.app:not(.rightbar-collapsed){
  --pad-right: calc(var(--rightbar-w) + var(--dock-gap) + 2px);
}
 */

#brushCursorPreview{
  position: fixed;          /* ✅ was absolute */
  left: 0; top: 0;
  width: 10px; height: 10px;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  pointer-events: none;
  display: none;

  z-index: 2147483000;      /* ✅ above everything */

  mix-blend-mode: difference;
  border: 1px solid rgba(255,255,255,.9);
  box-shadow: 0 0 0 1px rgba(0,0,0,.55);
}



/* BRUSH_CURSOR_PREVIEW_SIMPLE (unique anchor) */
#brushCursorPreview.simple{
  border-style: solid;      /* no dashed */
  box-shadow: none;         /* simpler */
}

#brushCursorPreview.eraser{
  border-style: dashed;
}





/* MOBILE_ISLAND_TOGGLE_BTN (unique anchor) */
.mobileIslandToggle{
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 9999;              /* must be above canvases/panels */
  width: 46px;
  height: 46px;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: rgba(12,15,20,.9);
  color: #fff;
  font-size: 22px;
  line-height: 1;
  display: none;              /* desktop hidden */
  align-items: center;
  justify-content: center;
  touch-action: manipulation; /* make taps reliable */
}

@media (max-width: 900px){
  .mobileIslandToggle{ display: flex; }
}


/* MOBILE_TIMELINE_SCRUB (unique anchor) */
#tlPlayheadRow{
  touch-action: none;     /* critical: stops browser pan/zoom fighting your scrub */
  -webkit-user-select: none;
  user-select: none;
}

#islandToggleBtn,
.islandToggleBtn{
  position: relative;
  z-index: 10000;
  pointer-events: auto;
  touch-action: manipulation; /* makes taps more reliable */
}

/* -----------------------------
   Stage area
----------------------------- */
#stageWrap{
  position:relative;
  height:100%;
  padding-bottom: var(--timeline-h);
  padding-left: var(--pad-left);
  padding-right: var(--pad-right);

  display:flex;
  align-items:stretch;     /* was center */
  justify-content:stretch; /* was center */

  background: radial-gradient(60% 60% at 50% 50%, #0f141b, #0b0e12);
  min-height:0;

  overscroll-behavior: contain;

  touch-action: none;          /* ✅ ADD */
  -webkit-user-select: none;   /* (optional but good) */
  user-select: none;
  
}





#stage{
  position:relative;
  flex: 1 1 auto;
  width: auto;
  height: auto;
  min-width:0;
  min-height:0;

  border:1px solid var(--border);
  background:#0c0f14;
  box-shadow: inset 0 6px 28px rgba(0,0,0,.35);



  touch-action: none;
  overscroll-behavior: contain;
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  
}



canvas#boundsCanvas,
canvas#drawCanvas,
canvas#fxCanvas{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;

  transform-origin: 0 0;   /* ✅ critical for stable pinch math */
  will-change: transform;  /* ✅ smoother on mobile */
}

/* HIDE_NATIVE_CURSOR_ON_CANVAS */
#drawCanvas,
#boundsCanvas,
#fxCanvas{
  cursor: none !important;
}

#drawCanvas{
  touch-action: none;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

#boundsCanvas{ z-index: 1; }
#drawCanvas{ z-index: 2; }
#fxCanvas{ z-index: 3; }

#boundsCanvas,
#fxCanvas{ pointer-events:none; }

/* HUD */
#hud{
  position:absolute;
  left:10px;
  top:10px;
  display:flex;
  gap:8px;
  align-items:center;
  background: rgba(18,22,28,.75);
  border:1px solid #293042;
  padding:6px 8px;
  border-radius:5px;
  backdrop-filter: blur(6px);
  font-size:12px;
  color:#c7d0db;
  z-index: 6;
}
#hud .sep{ width:1px; height:16px; background:#2a3240; margin:0 4px; }
#zoomInfo{ min-width:64px; text-align:right; }
#frameInfo{ min-width:86px; text-align:right; }



/* -----------------------------
   Floating Left Dock (Tools)
----------------------------- */
#tools{
  position:fixed;
  top: var(--header-h);
  left: var(--dock-gap);
  bottom: calc(var(--timeline-h) + var(--dock-gap-bottom));
  width: var(--sidebar-w);

  background: var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px 12px;
  box-shadow: 12px 0 24px rgba(0,0,0,.25);

  overflow:auto;
  z-index: 8;
}
#tools h2{
  margin:0 0 8px;
  font-size:12px;
  color:#c7d0db;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.08em;
}
.tool-group{
  background:#0f141b;
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  margin-bottom: 12px;
}

/* -----------------------------
   Floating Right Dock (Colors / Ops)
----------------------------- */
#toolsRight{
  position:fixed;
  top: var(--header-h);
  right: var(--dock-gap);
  bottom: calc(var(--timeline-h) + var(--dock-gap-bottom));
  width: var(--rightbar-w);

  background: var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px 12px;
  box-shadow: -12px 0 24px rgba(0,0,0,.25);

  overflow:auto;
  z-index: 8;
}



/* --- Island tool icon mapping (edit filenames if yours differ) --- */
#islandToolsSlot #toolSeg > label[data-tool="brush"]      { --tool-icon: url("./icons/tool-brush.svg"); }
#islandToolsSlot #toolSeg > label[data-tool="eraser"]     { --tool-icon: url("./icons/tool-eraser.svg"); }
#islandToolsSlot #toolSeg > label[data-tool="fill-eraser"]{ --tool-icon: url("./icons/tool-fill-eraser.svg"); }
#islandToolsSlot #toolSeg > label[data-tool="fill-brush"] { --tool-icon: url("./icons/tool-fill-brush.svg"); }
#islandToolsSlot #toolSeg > label[data-tool="lasso-fill"] { --tool-icon: url("./icons/tool-lasso-fill.svg"); }
#islandToolsSlot #toolSeg > label[data-tool="lasso-erase"]{ --tool-icon: url("./icons/tool-lasso-erase.svg"); }

/* --- Square tool buttons (your existing sizing is fine) --- */
#islandToolsSlot #toolSeg > label{
  position: relative;              /* for ::before */
  width: 34px !important;
  height: 34px !important;
  padding: 0 !important;
  flex: 0 0 auto !important;

  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(0,0,0,0.18);

  display: grid !important;
  place-items: center;

  font-size: 0;
  line-height: 0;
  cursor: pointer;

  /* IMPORTANT: remove background-image usage */
  background-image: none !important;
}

/* --- The icon itself (always white) --- */
#islandToolsSlot #toolSeg > label::before{
  content: "";
  width: 20px;
  height: 20px;

  background: rgba(255,255,255,0.92); /* icon color */

  -webkit-mask-image: var(--tool-icon);
  -webkit-mask-repeat: no-repeat;
  -webkit-mask-position: center;
  -webkit-mask-size: contain;

  mask-image: var(--tool-icon);
  mask-repeat: no-repeat;
  mask-position: center;
  mask-size: contain;
}

/* Selected tool outline */
#islandToolsSlot #toolSeg > input:checked + label{
  outline: 2px solid rgba(120, 200, 255, 0.90);
  outline-offset: 0;
}

/* When timeline is hidden, let sidebars use full height */
.app.tl-collapsed #tools,
.app.tl-collapsed #toolsRight{
  bottom: var(--dock-gap-bottom);
}

/* Collapsed docks */
.app.sidebar-collapsed #tools{ display:none; }
.app.rightbar-collapsed #toolsRight{ display:none; }

/* Edge “show” buttons */
.edge-btn{
  position:fixed;
  z-index: 11;
  box-shadow: var(--shadowTop);
  padding:6px 10px;
  border-radius:8px;
}
#showLeftEdge{ top: calc(var(--header-h) + 8px); left: var(--dock-gap); display:none; }
#showRightEdge{ top: calc(var(--header-h) + 8px); right: var(--dock-gap); display:none; }
#showTimelineEdge{ bottom: 8px; left: 50%; transform: translateX(-50%); display:none; }

.app.sidebar-collapsed #showLeftEdge{ display:block; }
.app.rightbar-collapsed #showRightEdge{ display:block; }
.app.tl-collapsed #showTimelineEdge{ display:block; }

/* -----------------------------
   Timeline (fixed bottom panel)
----------------------------- */
#timeline{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  height: var(--timeline-h);
  z-index: 10;

  background: var(--panel);
  border-top:1px solid var(--border);
  box-shadow: 0 -6px 16px rgba(0,0,0,.35);

  display:flex;
  flex-direction:column;
  min-height:0;
}

.app.tl-collapsed #timeline{ display:none; }
.app.tl-collapsed #stageWrap{ padding-bottom: 0; }
.app.tl-collapsed #stage{
  height: calc(100dvh - var(--header-h));
}

/* Timeline header layout (supports .left .center .right) */
#timelineHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:8px 12px;
  color:#c7d0db;
  gap:10px;
  flex-wrap:wrap;
  position: relative;
}
#timelineHeader .left,
#timelineHeader .right{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}
#timelineHeader .center{
  flex: 1 1 auto;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  flex-wrap:wrap;
}

/* Hide original transport buttons (if present) */
#timelineHeader #playBtn,
#timelineHeader #pauseBtn,
#timelineHeader #stopBtn,
#timelineHeader #prevFrame,
#timelineHeader #nextFrame,
#timelineHeader #jumpStart,
#timelineHeader #jumpEnd{ display:none; }

#timelineScroll{
  position:relative;
  overflow:auto;
  border-top:1px solid var(--border);
  border-bottom:1px solid var(--border);
  flex:1;
  background: var(--panel2);
  min-height:0;
}

/* ================================
   TIMELINE SCROLLBAR STYLING
   (Chrome/Edge/Opera + Firefox)
   ================================ */

/* Firefox */
#timelineScroll{
  scrollbar-width: thin; /* auto | thin | none */
  scrollbar-color: rgba(255,255,255,0.22) rgba(0,0,0,0.18);
}

/* WebKit (Chrome/Edge/Opera/Safari) */
#timelineScroll::-webkit-scrollbar{
  height: 12px;  /* horizontal */
  width: 12px;   /* vertical */
}

#timelineScroll::-webkit-scrollbar-track{
  background: rgba(0,0,0,0.18);
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.06);
}

#timelineScroll::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,0.20);
  border-radius: 999px;
  border: 3px solid rgba(0,0,0,0.18); /* creates “padding” around thumb */
}

#timelineScroll::-webkit-scrollbar-thumb:hover{
  background: rgba(255,255,255,0.30);
}

#timelineScroll::-webkit-scrollbar-thumb:active{
  background: rgba(255,255,255,0.38);
}

/* the little square where horizontal + vertical meet */
#timelineScroll::-webkit-scrollbar-corner{
  background: rgba(0,0,0,0.18);
}

/* Markers */
#playheadMarker,
#clipStartMarker,
#clipEndMarker{
  position:absolute;
  top:0;
  bottom:0;
  width:2px;
  pointer-events:none;
}

/* PLAYHEAD_BAND_FILL (unique anchor) */
#playheadMarker{
  /* make it span exactly ONE cel width */
  width: var(--frame-w);
  box-sizing: border-box; /* you already have global border-box, but just in case */

  /* transparent red fill using your --accent */
  background: color-mix(in srgb, var(--accent) 18%, transparent);

  /* red lines on BOTH sides */
  border-left: 2px solid var(--accent);
  border-right: 2px solid var(--accent);

  /* ensure it draws above the cells */
  z-index: 5;

  /* if you previously added box-shadow for the second line, remove it */
  box-shadow: none;
}



#clipStartMarker{ background:#00e676; }
#clipEndMarker{ background:#ff5252; }

/* Timeline table */
table#timelineTable{
  border-collapse: separate;
  border-spacing: 0;
  font-size:12px;
  color:#c7d0db;
  user-select:none;
}
#timelineTable td,
#timelineTable th{
  border:1px solid #1f2633;
  width: var(--frame-w);
  min-width: var(--frame-w);
  height: 28px;
  text-align:center;
  padding:0;
}
#timelineTable th.sticky{
  position: sticky;
  left: 0;
  z-index: 3;
  background: var(--sticky);
  border-right:1px solid var(--border);

  min-width: 200px;
  width:200px;
  text-align:left;
  padding:0 8px;
  font-weight:600;
}
#timelineTable tr.playhead-row td{
  border-top:1px solid #2a3240;
  border-bottom:1px solid #2a3240;
  border-left:none;
  border-right:none;
  background:#131821;
  color:var(--muted);
}
#timelineTable tr.playhead-row th.sticky{
  border:1px solid #2a3240;
}
#timelineTable tr.anim-row td{ background:#0f1319; }
#timelineTable tr.anim-row td.secondTick{ background:#101722; }
#timelineTable tr.anim-row td.hasContent{
  background:#214230;
  box-shadow: inset 0 0 0 2px rgba(24, 145, 60, 0.991);

  
}
#timelineTable tr.anim-row td.active{
  outline:2px solid var(--accent);
  outline-offset:-2px;
  box-shadow:
    inset 2px 0 0 var(--accent),
    inset -2px 0 0 var(--accent);
}

/* ✅ keep green "hasContent" ring AND show left+right red bracket when active */
#timelineTable tr.anim-row td.active.hasContent{
  box-shadow:
    inset 0 0 0 2px rgba(64, 255, 121, 0.802),
    inset 2px 0 0 var(--accent),
    inset -2px 0 0 var(--accent);
}
#timelineTable td.dropTarget{
  outline:2px solid #ffcc00;
  outline-offset:-2px/* Colors */;
}

/* -----------------------------
   HSV Wheel (Hue ring + SV square)
----------------------------- */
.hsv-wheel{
  width: 100%;
  max-width: 320px;      /* adjust if you want bigger */
  aspect-ratio: 1 / 1;
  margin-top: 6px;
  position: relative;
  border: 1px solid var(--border);
  border-radius: 14px;
  background: #0b0e12;
  overflow: hidden;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03);
}
.hsv-wheel-preview{
  width: 28px;
  height: 28px;
  position: absolute;
  left: 10px;
  bottom: 10px;

  border-radius: 7px;
  border: 1px solid rgba(255,255,255,0.18);
  box-shadow:
    0 0 0 2px rgba(0,0,0,0.45),
    inset 0 0 0 1px rgba(255,255,255,0.05);
  background: #000;
}

#hsvWheelCanvas{
  width: 100%;
  height: 100%;
  display: block;
  cursor: crosshair;
  touch-action: none;
}


/* UI Color Picker Anchor (used for paper & swatches) */
#uiColorPickWrap{
  position: fixed;
  z-index: 99999;
  display: none;
  padding: 6px;
  border-radius: 10px;
  background: rgba(30,30,30,.92);
  border: 1px solid rgba(255,255,255,.12);
  box-shadow: 0 10px 30px rgba(0,0,0,.55);
  color-scheme: dark; /* keeps it from flipping light */
}
#uiColorPickWrap input[type="color"]{
  width: 38px;
  height: 28px;
  border: 0;
  padding: 0;
  background: transparent;
  color-scheme: dark;
}


/* Cursor-anchored native color picker (hidden input we move to the mouse position) */
#cursorColorPicker{
  position: fixed;
  left: 0;
  top: 0;
  width: 1px;
  height: 1px;
  opacity: 0.001;   /* not fully 0 in case a browser refuses to open */
  pointer-events: none;
  z-index: 50;
}


/* Multi-cel selection highlight */
#timelineTable tr.anim-row td.selected{
  outline: 2px solid #00e5ff;
  outline-offset: -2px;
  background: #10212a;
}

/* Ghost preview while dragging (where the selection will land) */
#timelineTable tr.anim-row td.ghostTarget{
  outline: 2px dashed #00e5ff;
  outline-offset: -2px;
  background: rgba(0,229,255,.08);
}

/* Fade the original selection while dragging */
body.dragging-cel #timelineTable tr.anim-row td.selected{
  opacity: .45;
}


#timelineTable tr.anim-row td.selected.hasContent{
  background: #0f2a24;
}

body.selecting-cels{
  cursor: crosshair;
  user-select: none;
}


body.dragging-cel{ cursor: grabbing; user-select:none; }

/* Bottom timeline controls */
#timelineControlsBottom.tl-ctrls{
  display:flex;
  gap:8px;
  align-items:center;
  padding:8px 10px;
  border-top:1px solid #283241;
  background:#0c1117;
  position:sticky;
  bottom:0;
  z-index:2;
}
#timelineControlsBottom .spacer{ flex:1; }
#timelineControlsBottom button{
  padding:6px 10px;
  border-radius:8px;
  background:#131a22;
}
#timelineControlsBottom button:hover{ background:#1a222c; }

#inlineTlCtrls button{
  padding:4px 8px;
  border-radius:6px;
  background:#131a22;
}
#inlineTlCtrls button:hover{ background:#1a222c; }

button,
input,
select,
textarea{
  font-family: var(--font);
}


/* Make timeline header controls easier to tap */
#timelineHeader button,
#timelineHeader input[type="number"],
#timelineHeader .chip{ min-height:36px; }


/* ───────── Tool Options Popup ───────── */
.toolOptionsPopup{
  position: fixed;
  left: 0; top: 0;
  z-index: 9999;
  display: none;
  min-width: 220px;
  max-width: 320px;

  font-family: var(--font);
  color: rgba(255,255,255,0.92);

  background: rgba(18,18,18,0.98);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 12px;
  box-shadow: 0 14px 40px rgba(0,0,0,0.55);

  padding: 10px;
}

/* ensure everything inside inherits var(--font) */
.toolOptionsPopup button,
.toolOptionsPopup input{
  font-family: inherit;
  color: inherit;
}

.toolOptionsPopup.open{
  display: block;
}

.toolOptionsTitle{
  font-weight: 700;
  font-size: 13px;
  margin: 0 0 8px 0;
  opacity: 0.9;
}

.toolOptionsBody{
  display: grid;
  gap: 6px;
}

.toolOptBtn{
  width: 100%;
  text-align: left;

  display: flex;
  align-items: center;
  gap: 10px;

  padding: 6px 8px;                 /* match .toolOptCheck */
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04); /* match .toolOptCheck */

  cursor: pointer;
  font-size: 12px;
  line-height: 1.2;

  appearance: none;
}

.toolOptBtn:hover{
  background: rgba(255,255,255,0.07); /* match .toolOptCheck:hover */
}

.toolOptBtn:focus-visible{
  outline: 2px solid rgba(255,255,255,0.22);
  outline-offset: 2px;
}

/* ───────── Tool Options rows/controls ───────── */
.toolOptRow{
  display: grid;
  grid-template-columns: 52px 1fr 36px;
  gap: 8px;
  align-items: center;
}

.toolOptLabel{
  font-size: 12px;
  opacity: 0.85;
}

.toolOptRange{
  width: 100%;
}

.toolOptRead{
  font-variant-numeric: tabular-nums;
  text-align: right;
  font-size: 12px;
  opacity: 0.9;
}

.toolOptCheck{
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 6px 8px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
  cursor: pointer;
}
.toolOptCheck:hover{
  background: rgba(255,255,255,0.07);
}
.toolOptCheck input{
  transform: translateY(0.5px);
}

/* -----------------------------
   Optional: Dockable floating panels (if you use them)
----------------------------- */
.dock-panel > h2{
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size:14px;
  margin:0 0 8px 0;
  padding:6px 8px;
  background:#0f141b;
  border:1px solid var(--border);
  border-radius:8px;
}
.dock-panel .dock-btns .float-btn{
  background:var(--btn-bg);
  color:#dfe7f1;
  border:1px solid var(--btn-bd);
  border-radius:6px;
  padding:2px 6px;
  cursor:pointer;
}
.dock-panel .dock-btns .float-btn:hover{
  background:var(--btn-bg-h);
  border-color:var(--btn-bd-h);
}

.floating-panel{
  position:absolute;
  z-index: 14;
  width: 320px;
  max-width: 48vw;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 10px;
  box-shadow: var(--shadowDock);
  overflow:hidden;
}
.floating-panel .fp-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:#0f141b;
  color:#cbd3df;
  padding:8px 10px;
  border-bottom:1px solid var(--border);
  cursor: move;
  user-select:none;
}
.floating-panel .fp-title{ font-weight:600; font-size:14px; }
.floating-panel .fp-btns button{
  background:var(--btn-bg);
  color:#dfe7f1;
  border:1px solid var(--btn-bd);
  border-radius:6px;
  padding:2px 6px;
  cursor:pointer;
}
.floating-panel .fp-btns button:hover{
  background:var(--btn-bg-h);
  border-color:var(--btn-bd-h);
}
.floating-panel .fp-body{
  padding:10px;
  max-height: calc(100dvh - var(--header-h) - var(--timeline-h) - 20px);
  overflow:auto;
}



/* Layer row layout (make sure your row is flex so the left button sits nicely) */
.layerRow{
  display:flex;
  align-items:center;
  gap:8px;
}

/* Left hide/show button */
.lyVisBtn{
  width:22px;
  height:22px;
  flex:0 0 22px;

  display:grid;
  place-items:center;

  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.06);
  color:#fff;

  border-radius:6px;
  cursor:pointer;
  user-select:none;
}

.lyVisBtn:hover{
  background:rgba(255,255,255,.10);
}

/* Visual hint when hidden */
.layerRow.is-hidden .lyVisBtn{
  opacity:.35;
}

.layerRow.is-hidden .layerName,
.layerRow.is-hidden .swatchBtn{
  opacity:.55;
}


/* -----------------------------
   Layer visibility ops (if present)
----------------------------- */
#layerVisOps .layerRows{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-top:6px;
}
#layerVisOps .row{
  display:grid;
  grid-template-columns: 18px 1fr 84px;
  align-items:center;
  gap:8px;
}
#layerVisOps .row label{
  font-size:12px;
  color:#c7d0db;
}
#layerVisOps input[type="range"]{ width:100%; }
#layerVisOps .actions{ display:flex; gap:8px; margin-top:8px; }

/* -----------------------------
   Compatibility: hide old floating colorDock if it still exists
----------------------------- */
#colorDock{ display:none; }

/* -----------------------------
   Responsive
----------------------------- */
@media (max-width: 900px){
  :root{
    --sidebar-w: 240px;
    --rightbar-w: 260px;
    --timeline-h: 180px;

      /* UI scale */
    --ui-font: 14px;          /* default desktop */
    --ui-font-tight: 12px;    /* small UI text */
  }
  #timelineHeader .center,
  #timelineHeader .right{ gap: 8px; }
}


/* hide arrows by default (desktop) */
.tlMobArrow{ display:none; }

/* make absolute arrows + drawers position relative to header */
#timelineHeader{ position: relative; }
/* =========================================================
   MOBILE (tablet/phone)
   - smaller type everywhere
   - timeline shorter + cells smaller
   - island smaller
   ========================================================= */
@media (max-width: 720px){
  :root{
    --ui-font: 12px;
    --ui-font-tight: 11px;

    --header-h: 42px;
    --timeline-h: 150px;

    --frame-w: 20px;
    --dock-gap: 10px;
    --dock-gap-bottom: 6px;
  }

  header.top{ padding: 8px 10px; }
  .brand{ gap: 8px; }
  .brand .logo{ width:18px; height:18px; border-radius:5px; }

  /* Buttons/controls tighter */
  :where(button, .seg input + label, .dock-btn, .edge-btn){
    padding: 6px 8px;
    border-radius: 9px;
  }

  /* HUD smaller */
  #hud{
    left: 8px; top: 8px;
    padding: 5px 7px;
    font-size: 11px;
    gap: 6px;
  }


  /* =========================
   MOBILE: shrink Floating Island
   ========================= */
  @media (max-width: 720px){

    /* smaller island box */
    #floatingIsland.islandDock{
      width: 100px;
      height: 220px;

      min-width: 180px;
      min-height: 260px;

      left: 10px;
      top: calc(var(--header-h) + 8px);
    }

    /* tighter header + title */
    #floatingIsland .islandHeader{ height: 24px; padding: 0 6px; }
    #floatingIsland .islandTitle{ font-size: 11px; letter-spacing: 0.06em; }

    /* smaller header buttons */
    #floatingIsland .islandBtn{
      width: 22px;
      height: 20px;
      border-radius: 0; /* keep square */
    }

    /* tighter body/panels */
    #floatingIsland .islandBody{ padding: 8px; gap: 8px; }
    #floatingIsland .islandTop{ gap: 8px; }
    #floatingIsland .islandPanel{ padding: 6px; }

    /* tool grid smaller */
    #floatingIsland #islandToolsSlot #toolSeg{
      grid-template-columns: repeat(2, 30px);
      grid-auto-rows: 30px;
      gap: 6px;
    }
    #floatingIsland #islandToolsSlot #toolSeg > label{
      width: 30px !important;
      height: 30px !important;
      border-radius: 0 !important;
    }
    #floatingIsland #islandToolsSlot #toolSeg > label::before{
      width: 18px;
      height: 18px;
    }

    /* layers rows smaller */
    #floatingIsland #islandLayersSlot #layerSeg > label{
      min-height: 32px;
      padding: 5px 6px;
      font-size: 12px;
      border-radius: 0 !important;
    }

    /* swatches slightly smaller so rows don't overflow */
    #floatingIsland #islandLayersSlot .layerSwatchBtn{
      width: 14px;
      height: 14px;
      border-radius: 0;
    }

    /* (optional) side panel smaller on mobile */
    #islandSidePanel{
      width: 160px;
    }
  }

  /* ───────── Mobile timeline: left/right collapse into arrows ───────── */

  /* show arrows only on mobile */
  .tlMobArrow{ display:none; }
  @media (max-width: 720px){
    .tlMobArrow{
      display: inline-flex;
      align-items: center;
      justify-content: center;

      width: 30px;
      height: 30px;
      padding: 0;

      border-radius: 10px;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 12;
    }

    .tlMobLeft{ left: 8px; }
    .tlMobRight{ right: 8px; }

    /* make room so center buttons don’t overlap arrows */
    #timelineHeader{
      padding-left: 44px;
      padding-right: 44px;
    }

    /* hide the big left/right blocks by default */
    #timelineHeader .left,
    #timelineHeader .right{
      display: none;
      position: absolute;
      bottom: calc(100% + 8px);
      z-index: 12;

      background: rgba(18, 20, 24, 0.96);
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: 0 18px 50px rgba(0,0,0,0.55);
      border-radius: 12px;
      padding: 10px;

      max-width: min(92vw, 360px);
    }

    /* left drawer (info) */
    #timelineHeader .left{
      left: 8px;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }

    /* right drawer (options) */
    #timelineHeader .right{
      right: 8px;
      flex-direction: column;
      align-items: stretch;
      gap: 8px;
    }

    /* open states */
    #timeline.mob-left-open #timelineHeader .left{ display: flex; }
    #timeline.mob-right-open #timelineHeader .right{ display: flex; }

    /* rotate arrow when open */
    #timeline.mob-left-open  #tlMobLeftBtn,
    #timeline.mob-right-open #tlMobRightBtn{
      transform: translateY(-50%) rotate(180deg);
    }

    /* tighten the right drawer controls a bit */
    #timelineHeader .right button{
      padding: 6px 8px;
      border-radius: 8px;
    }
    #timelineHeader .right input[type="number"]{
      width: 64px !important;
      min-height: 32px;
    }
  }


    /* ───────── Mobile: smaller floating island ───────── */
  .islandDock{
    left: 10px;
    top: calc(var(--header-h) + 10px);

    width: 210px;
    height: 320px;

    min-width: 120px;
    min-height: 250px;
  }

  .islandHeader{
    height: 26px;
    padding: 0 6px;
  }

  .islandTitle{
    font-size: 11px;
    letter-spacing: 0.06em;
  }

  .islandBtns{ gap: 5px; }

  .islandBtn{
    width: 24px;
    height: 20px;
    font-size: 12px;
  }

  .islandBody{
    padding: 8px;
    gap: 8px;
  }

  .islandPanel{
    padding: 6px;
  }

  /* tools grid smaller */
  #islandToolsSlot #toolSeg{
    grid-template-columns: repeat(2, 30px);
    grid-auto-rows: 30px;
    gap: 6px;
  }

  #islandToolsSlot #toolSeg > label{
    width: 30px !important;
    height: 30px !important;
  }

  #islandToolsSlot #toolSeg > label::before{
    width: 18px;
    height: 18px;
  }

  /* layer rows tighter */
  #islandLayersSlot #layerSeg > label{
    min-height: 32px;
    padding: 5px 6px;
  }

  /* optional: side panel smaller on mobile */
  #islandSidePanel{
    width: 170px;
  }



  /* ───────── Mobile timeline: smaller buttons/controls ───────── */

  /* overall header tighter */
  #timelineHeader{
    padding: 6px 8px;
    gap: 6px;
  }

  /* buttons smaller */
  #timelineHeader button{
    padding: 4px 6px;
    min-height: 28px;
    border-radius: 8px;
    font-size: 11px;
    line-height: 1;
  }

  /* badges smaller */
  #timelineHeader .badge{
    font-size: 10px;
    padding: 2px 7px;
  }

  /* labels smaller */
  #timelineHeader label{
    font-size: 11px;
  }

  /* number inputs smaller */
  #timelineHeader input[type="number"]{
    width: 54px !important;
    min-height: 28px;
    padding: 3px 6px;
    font-size: 11px;
  }

  /* checkboxes a bit smaller */
  #timelineHeader input[type="checkbox"]{
    transform: scale(0.9);
    transform-origin: left center;
  }
  table#timelineTable{ font-size: 11px; }
  #timelineTable td,
  #timelineTable th{ height: 24px; }
  #timelineTable th.sticky{
    width: 150px;
    min-width: 150px;
    font-size: 11px;
  }

  /* Island: smaller footprint */
  .islandDock{
    left: 10px;
    top: calc(var(--header-h) + 10px);
    width: 220px;
    height: 3340px;

    min-width: 200px;
    min-height: 260px;

    max-width: calc(100vw - 12px);
    max-height: calc(100dvh - var(--header-h) - var(--timeline-h) - 12px);
  }
  .islandBody{ padding: 8px; gap: 8px; }
  .islandPanel{ padding: 7px; }

  .islandBtn{ width: 24px; height: 20px; }

  /* Island tool grid slightly smaller */
  #islandToolsSlot #toolSeg{
    grid-template-columns: repeat(2, 30px);
    grid-auto-rows: 30px;
    gap: 7px;
  }
  #islandToolsSlot #toolSeg > label{
    width: 30px !important;
    height: 30px !important;
  }
  #islandToolsSlot #toolSeg > label::before{
    width: 18px;
    height: 18px;
  }


  #onionOptionsStash{ display:none; }
  /* Onion ctx menu should never overflow phone width */
  #onionCtxMenu{
    width: min(270px, calc(100vw - 16px));
  }
}

/* =========================================================
   SMALL PHONES
   - even tighter
   ========================================================= */
@media (max-width: 480px){
  :root{
    --ui-font: 11px;
    --ui-font-tight: 10px;

    --header-h: 40px;
    --timeline-h: 130px;

    --frame-w: 18px;
  }

  #hud{ font-size: 10px; }

  #timelineHeader .left strong{ font-size: 12px; }
  #timelineHeader input[type="number"]{
    width: 56px !important;
  }

  table#timelineTable{ font-size: 10px; }
  #timelineTable td,
  #timelineTable th{ height: 22px; }
  #timelineTable th.sticky{
    width: 130px;
    min-width: 130px;
  }

  .islandDock{
    width: 205px;
    height: 300px;
    min-width: 190px;
    min-height: 250px;
  }

  #islandSidePanel{
    width: 175px;
  }
}

  /* ───────── Small phones: even smaller island ───────── */
  .islandDock{
    width: 190px;
    height: 280px;

    min-width: 170px;
    min-height: 230px;
  }

  .islandBody{
    padding: 7px;
    gap: 7px;
  }

  /* tools grid even smaller */
  #islandToolsSlot #toolSeg{
    grid-template-columns: repeat(2, 28px);
    grid-auto-rows: 28px;
    gap: 6px;
  }

  #islandToolsSlot #toolSeg > label{
    width: 28px !important;
    height: 28px !important;
  }

  #islandToolsSlot #toolSeg > label::before{
    width: 17px;
    height: 17px;
  }

  #islandSidePanel{
    width: 160px;
  }

/* =========================================================
   FLOATING ISLAND (Wheel + Tools + Layers)
   ========================================================= */

.islandDock{
  position: fixed;
  left: 18px;
  top: 76px;
  width: 250px;
  height: 400px;
  z-index: 40; /* under brushCursorPreview (yours is higher), above UI */

  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(18, 20, 24, 0.92);
  box-shadow: 0 18px 50px rgba(0,0,0,0.55);
  border-radius: 0px;
  overflow: hidden;

  user-select: none;
  -webkit-user-select: none;

  display: flex;
  flex-direction: column;

  min-width: 240px;
  min-height: 300px;

  /* keep it on-screen while resizing */
  max-width: calc(100vw - 12px);
  max-height: calc(100vh - 12px);


  --island-side-gap: 0px; 
}

/* bottom-right resize grip */
.islandResizeHandle{
  position: absolute;
  right: 6px;
  bottom: 6px;
  width: 16px;
  height: 16px;
  cursor: se-resize;
  opacity: 0.8;

  /* simple “corner” mark */
  border-right: 2px solid rgba(255,255,255,0.28);
  border-bottom: 2px solid rgba(255,255,255,0.28);
}

.islandDock.resizing .islandHeader{
  cursor: se-resize;
}

.islandHeader{
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 8px;

  background: rgba(255,255,255,0.06);
  border-bottom: 1px solid rgba(255,255,255,0.10);

  cursor: grab;
}

.islandDock.dragging .islandHeader{
  cursor: grabbing;
}

.islandTitle{
  font-size: 12px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.75);
}

.islandBtns{
  display: flex;
  gap: 6px;
}

.islandBtn{
  width: 26px;
  height: 22px;
  border-radius: 0px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(0,0,0,0.18);
  color: rgba(255,255,255,0.85);
  cursor: pointer;
}

.islandBtn:active{
  transform: translateY(1px);
}

.islandBody{
  padding: 10px;
  display: grid;
  grid-template-rows: auto 1fr; /* ✅ top area + layers area */
  gap: 10px;

  flex: 1 1 auto;   /* ✅ fill below header */
  min-height: 0;    /* ✅ critical for scroll containment */
  overflow: hidden; /* ✅ prevents inner overflow leaking past rounded corners */
}

.islandTop{
  display: grid;
  grid-template-columns: minmax(0, 1fr) minmax(0, 1fr); /* ✅ critical */
  gap: 10px;
  min-width: 0;
}

.islandPanel{
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(0,0,0,0.18);
  border-radius: 0px;
  padding: 8px;
  min-width: 0;
  min-height: 0;
  overflow: hidden;
}

.islandWheelSlot{
  display: grid;
  place-items: center;
  padding: 2px;
  overflow: visible;
}

/* Make the wheel area square & responsive */
#islandWheelSlot #hsvWheelWrap{
  width: 100%;
  aspect-ratio: 1 / 1;
}

/* Tools slot must not let inner content overflow */
#islandToolsSlot{
  min-width: 0;
  overflow: hidden;
  display: flex;
  justify-content: center; /* center the grid inside the slot */
  align-items: flex-start;
}

/* 2×3 square grid */
#islandToolsSlot #toolSeg{
  display: grid;
  grid-template-columns: repeat(2, 34px);
  grid-auto-rows: 34px;
  gap: 8px;

  width: fit-content;
  max-width: 100%;
}

/* Hide radios */
#islandToolsSlot #toolSeg > input{
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

/* ✅ Force square buttons even if base .seg label uses flex/width:100% */
#islandToolsSlot #toolSeg > label{
  width: 34px !important;
  height: 34px !important;
  aspect-ratio: 1 / 1;
  flex: 0 0 auto; /* prevent flex stretching */
  min-width: 0;
  padding: 0 !important;

  border-radius: 0px;
  border: 1px solid rgba(255,255,255,0.14);
  background-color: rgba(0,0,0,0.18);

  display: grid !important;
  place-items: center;

  background-image: var(--tool-icon);
  background-repeat: no-repeat;
  background-position: center;
  background-size: 20px 20px;

  font-size: 0;
  line-height: 0;
  cursor: pointer;
}

#islandToolsSlot #toolSeg > input:checked + label{
  outline: 2px solid rgba(120, 200, 255, 0.90);
  outline-offset: 0;
}

/* ───────── Island: Layers slot = VERTICAL list ───────── */
#islandLayersSlot{
  flex: 1 1 auto;
  min-height: 0;
  overflow: auto; /* ✅ was: auto */
  display: flex;
  flex-direction: column;
  gap: 8px;
  border-radius: 0px;
}

/* ISLAND: force layers into ONE vertical column */
#islandLayersSlot #layerSeg{
  display: flex !important;
  flex-direction: column !important;
  flex-wrap: nowrap !important;
  
}

/* each layer row spans full width */
#islandLayersSlot #layerSeg > label{
  width: 100% !important;
  flex: 0 0 auto !important;
  border-radius: 0px;
}

/* swatches stay on ONE line (no wrapping into extra rows/columns) */
#islandLayersSlot #layerSeg .layerSwatches{
  flex-wrap: nowrap !important;
  white-space: nowrap !important;
  overflow: hidden !important; /* keeps row from growing */
}

/* (optional) keep swatch buttons from forcing wrap */
#islandLayersSlot .layerSwatchBtn{
  flex: 0 0 auto !important;
}

/* name on left, swatches on right */
#islandLayersSlot #layerSeg .layerName{
  flex: 0 0 auto;
}

/* keep inputs hidden (if your base CSS doesn't already do this) */
#islandLayersSlot #layerSeg > input{
  display: none;
}

/* ───────── Island: make layers fit INSIDE island ───────── */

/* the island inner layout must allow children to shrink */
#floatingIsland,
#floatingIsland *{
  box-sizing: border-box;
}

/* If your island has a body wrapper, make it flex and allow shrink */
#floatingIslandBody{
  display: flex;
  flex-direction: column;
  min-height: 0; /* ✅ critical: allows inner slots to shrink */
}

/* Layers slot takes remaining space and scrolls */
#islandLayersSlot{
  flex: 1 1 auto;  /* ✅ fill remaining island height */
  min-height: 0;   /* ✅ critical */
  overflow: auto;  /* ✅ scroll instead of spilling out */
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* layerSeg itself should not force height */
#islandLayersSlot #layerSeg{
  display: flex;
  flex-direction: column;
  gap: 8px;
  min-height: 0;
}

/* each row should not be too tall */
#islandLayersSlot #layerSeg > label{
  width: 100%;
  min-height: 36px; /* smaller so it fits */
  padding: 6px 8px;
  overflow: hidden; /* prevents swatches from pushing outside */
}

/* keep swatches from blowing out the row width */
#islandLayersSlot #layerSeg .layerSwatches{
  flex: 1 1 auto;
  min-width: 0;
  overflow: hidden;
  display: flex;
  justify-content: flex-end;
  gap: 6px;
  flex-wrap: wrap; /* wrap if many swatches */
}

/* Collapsed -> hide body (supports BOTH class and id body wrappers) */
.islandDock.collapsed .islandBody,
.islandDock.collapsed #floatingIslandBody,
#floatingIsland.collapsed .islandBody,
#floatingIsland.collapsed #floatingIslandBody{
  display: none !important;
}

/* force-hide layers slot when island is collapsed */
.islandDock.collapsed #islandLayersSlot,
#floatingIsland.collapsed #islandLayersSlot{
  display: none !important;
}

/* show the tab when collapsed */
.islandDock.collapsed #islandTab,
#floatingIsland.collapsed #islandTab{
  display: block !important;
  opacity: 1 !important;
  pointer-events: auto !important;
}

/* make collapse LOOK collapsed (shrink + hide resize grip) */
.islandDock.collapsed,
#floatingIsland.collapsed{
  height: auto !important;
  min-height: 0 !important;
}

.islandDock.collapsed .islandResizeHandle,
#floatingIsland.collapsed .islandResizeHandle{
  display: none !important;
}

#islandTab{
  display: none;
  width: 100%;
  border: 0;
  border-top: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.85);
  padding: 10px 8px;
  cursor: pointer;

  pointer-events: none;

  font-size: 12px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
}

/* =========================================================
   ISLAND SIDE PANEL (slides out to the right)
   ========================================================= */

/* default: keep island clipped */
.islandDock{ overflow: hidden; }

/* when side panel is open, allow it to stick out */
.islandDock.side-open{ overflow: visible; }

#islandSidePanel{
  position: absolute;
  top: 0;
  left: calc(100% + var(--island-side-gap, 10px));
  height: 100%;
  width: 190px;

  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(18, 20, 24, 0.92);
  box-shadow: 0 18px 50px rgba(0,0,0,0.55);
  border-radius: 0px;

  display: flex;
  flex-direction: column;

  opacity: 0;
  transform: translateX(-6px);
  pointer-events: none;
  transition: opacity 160ms ease, transform 160ms ease;
}

.islandDock.side-open #islandSidePanel{
  opacity: 1;
  transform: translateX(0);
  pointer-events: auto;
}

.islandSideHeader{
  height: 28px;
  display: flex;
  align-items: center;
  padding: 0 10px;

  background: rgba(255,255,255,0.06);
  border-bottom: 1px solid rgba(255,255,255,0.10);

  font-size: 12px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.75);
}

.islandSideBody{
  flex: 1 1 auto;
  min-height: 0;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow: auto;
}


/* placeholder buttons layout — 1 column */
.islandSideGrid{
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.saveStateBadge{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: 28px;
  padding: 4px 8px;
  font-size: 11px;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  border: 1px solid rgba(255,255,255,0.16);
  background: rgba(255,255,255,0.08);
  color: rgba(255,255,255,0.88);
}

.saveStateBadge.dirty{
  border-color: rgba(255, 196, 102, 0.55);
  color: #ffdca2;
}

.saveStateBadge.saving{
  border-color: rgba(120, 200, 255, 0.55);
  color: #b9e6ff;
}

.saveStateBadge.error{
  border-color: rgba(255, 120, 120, 0.6);
  color: #ffc4c4;
}

.islandSideRow{
  display: flex;
  gap: 8px;
}

.sideBtn{
  height: 34px;
  border-radius: 0px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(0,0,0,0.18);
  color: rgba(255,255,255,0.85);
  cursor: pointer;
}

/* Side panel buttons: square corners */
#islandSidePanel button,
#islandSidePanel .sideBtn{
  border-radius: 0 !important;
}




.sideBtn:active{ transform: translateY(1px); }

.sideBtn.wide{
  flex: 1 1 auto;
}



/* ================================
   TIMELINE: Onion right-click menu
   ================================ */

#onionCtxMenu{
  position: fixed;
  z-index: 9999999;
  width: 270px;
  padding: 10px;
  border-radius: 12px;

  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(18, 20, 24, 0.96);
  box-shadow: 0 18px 50px rgba(0,0,0,0.55);

  display: none;
  pointer-events: none;
  opacity: 0;
  transform: translateY(4px);
  transition: opacity 140ms ease, transform 140ms ease;
}

#onionCtxMenu.open{
  display: block;
  pointer-events: auto;
  opacity: 1;
  transform: translateY(0);
}

#onionCtxMenu .subhead{
  font-size: 12px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.75);
  margin: 2px 0 8px;
}

#onionCtxMenu .row,
#onionCtxMenu .rangeRow{
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 8px 0;
}

#onionCtxMenu .row label{
  flex: 0 0 92px;
  font-size: 12px;
  color: rgba(255,255,255,0.75);
}

#onionCtxMenu input[type="color"]{
  width: 42px;
  height: 26px;
  padding: 0;
  border: 1px solid rgba(255,255,255,0.14);
  border-radius: 8px;
  background: rgba(0,0,0,0.25);
}

#onionCtxMenu input[type="range"]{
  flex: 1 1 auto;
}

#onionCtxMenu .val{
  width: 28px;
  text-align: right;
  color: rgba(255,255,255,0.85);
  font-size: 12px;
}

#onionCtxMenu .chip{
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: rgba(255,255,255,0.80);
}
